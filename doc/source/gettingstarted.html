{% extends "_base.html" %}

{% block title %}pywebgen / getting started{% endblock %}

{% block contents %}
<script type="text/javascript">
jQuery(document).ready(function() {
  if (jQuery('#contents h2').length> 1) {
    jQuery('<h2>Table of contents</h2>')
      .insertBefore('h2:first')
      .after('<ul id="toc"></ul>');

    jQuery('#contents h2:not(:first)').each(function(index) {
      jQuery('<li></li>').appendTo('#toc');
      jQuery('<a></a>')
        .attr({ 'href': '#' + this.id })
        .html(jQuery(this).html())
        .appendTo('#toc li:last');
    });
  }
});
</script>

<img class="intro" src="images/gettingstarted.jpg"
     alt="Getting started" />

<p class="intro">Getting started with pywebgen is quite simple. This
  section will show you how to create your first pywebgen powered
  website.</p>


<h2 id="creating-the-website">Creating the website</h2>

<p>In this guide we'll use the simplest form of pywebgen, a fully
  integrated environment that simplifies managing your static
  website. To create it, use the <tt>startsite</tt> command:</p>

<pre>
$ pywebgen startsite demo
</pre>

<p>This creates a <tt>demo</tt> directory, containing the following:</p>

<ul>
  <li><tt>source</tt>: the website's source (obviously).</li>

  <li><tt>versions</tt>: contains the successive versions of the
    generated site. You shouldn't have to poke in here directly, so
    don't worry about it.</li>

  <li><tt>current</tt>: this symbolic link points to the generated
    version that is marked as the current "live" version.</li>

  <li><tt>latest</tt>: this symbolis link always points to the last
    generated version of the site.</li>

  <li><tt>pwg</tt>: a simplified version of <tt>pywebgen</tt> that you
    will use to manage this site.</li>
</ul>

<p>If you point your web browser to the <tt>latest</tt> directory, you
  should get an empty directory listing. Congratulations, that is your
  first generated website!</p>

<p>Of course, since there are no sources, the generated site is also
  quite empty. Let's remedy that.</p>


<h2 id="a-first-page">A first page</h2>

<p>Create the file <tt>demo/source/index.html</tt>, containing the
  following:</p>

<pre class="prettyprint">{% filter escape %}{% raw %}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en-us">
  <head>
    <title>Hello world!</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>
  <body>
    <h1>Hello world!</h1>

    <p>This page was generated by pywebgen on {{timestamp}}.</p>
  </body>
</html>
{% endraw %}{% endfilter %}</pre>

<p>Now, regenerate your website:</p>

<pre>
$ ./pwg generate
Generated version 20081220-231049
</pre>

<p>Pywebgen tells you when you execute that command that it generated
  a new version of your website, and gives you the timestamp of that
  version. Now, if you refresh the browser you had pointed at
  the <tt>latest</tt> directory, you should get your hello world
  back!</p>

<p>Note that while the page is mostly HTML, we're already using a
  little bit of the template engine: when you wrote
  <tt>{{'{{'}}timestamp{{'}}'}}</tt> in the page, pywebgen replaced
  this with the date and time at which the final page was
  generated.</p>


<h2 id="the-development-webserver">The development webserver</h2>

<p>You may be thinking at this point that regenerating every few
  seconds while you're tweaking your site is a bit cumbersome. For
  this reason, pywebgen comes with a small embedded webserver that
  takes away that annoyance. While you're hacking on your website,
  simply boot the development webserver:</p>

<pre>
$ ./pwg devel
Listening on http://localhost:8000/
</pre>

<p>As <tt>pwg</tt> tells you, your generated website is now being
  served on {{"http://localhost:8000"|urlize}}. It will automatically
  regenerate the site periodically, so you can simply hit refresh
  while you're developing and see your changes reflected immediately!</p>

<p>The development versions of the website are not stored permanently,
  and all trace of them will be deleted when you shut down the
  development webserver. Therefore, once you're happy with what you
  have, you should still generate a "final" version using <tt>pwg
  generate</tt>.</p>

<p>If you're building this site as you're reading, leave the
  development webserver running, as we'll link to pages on it from
  time to time in this guide.</p>


<h2 id="death-to-boilerplate">Death to boilerplate!</h2>

<p>With a single page, we're looking pretty good. However, as soon as
  we start adding more, we're going to duplicate all the heavy
  boilerplate that HTML (and perhaps your website) have.</p>

<p>Instead, create <tt>demo/source/_base.html</tt> with the following
  contents:</p>

<pre class="prettyprint lang-html">{% filter escape %}{% raw %}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en-us">
  <head>
    <title>{% block title %}{% endblock %}</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>
  <body>
    {% block contents %}{% endblock %}
  </body>
</html>
{% endraw %}{% endfilter %}</pre>

<p>And modify <tt>demo/source/index.html</tt>:</p>

<pre class="prettyprint lang-html">{% filter escape %}{% raw %}
{% extends "_base.html" %}

{% block title %}Hello world!{% endblock %}

{% block contents %}
<h1>Hello world!</h1>
<p>This page was generated by pywebgen on {{timestamp}}.</p>
{% endblock %}
{% endraw %}{% endfilter %}</pre>

<p>If you take another look at {{"http://localhost:8000"|urlize}}, you
  should see no change. Pywebgen automatically expanded the template,
  injecting your custom block contents into the base template.</p>

<p>The difference of course is in maintainability: you can now create
  a <tt>demo/source/about.html</tt> page that reuses exactly the same
  base boilerplate:</p>

<pre class="prettyprint lang-html">{% filter escape %}{% raw %}
{% extends "_base.html" %}

{% block title %}About this site{% endblock %}

{% block contents %}
<h1>About this site</h1>
<p>This site was generated by pywebgen on {{timestamp}}, and uses
  Jinja2's template feature!</p>
{% endblock %}
{% endraw %}{% endfilter %}</pre>

<p>Once you've created this page,
{{"http://localhost:8000/about.html"|urlize}} through the development
webserver. You now have two pages that are using the same basic page
scaffolding. Anything you add to <tt>demo/source/_base.html</tt> will
propagate to all the pages in your site that base themselves on
it.</p>


<h2 id="adding-a-stylesheet">Adding a stylesheet</h2>

<p>Now that we have a basic (very basic!) site, we should add a CSS
stylesheet. Pywebgen provides a small language based
on <a href="http://www.yaml.org/">YAML</a> to describe styles, which
gets compiled into a CSS stylesheet. This language provides a couple
of nice features that CSS doesn't have: hierarchical definitions, and
references to variables. Let's take a look at an example stylesheet,
to see how these work:</p>

<pre>
VARS:
  pythonblue: hex(3779af)

body:
  padding: 1em
  background-color: white

id(contents):
  border: 1px solid black
  padding: 2em

  h1:
    margin-left: 2em
    color: $pythonblue
</pre>

<p>This stylesheet uses all the features of the description
  language. Note the reference to the <tt>pythonblue</tt> variable,
  and the way that style for the <tt>h1</tt> is contained within
  the <tt>id(contents)</tt> block.</p>

<p>You probably also noticed two strange things, if you know CSS:
the <tt>id()</tt> and <tt>hex()</tt> functions. These are here due to
an unfortunate limitation of the language: since it is based on YAML,
the <tt>#</tt> sign is the comment delimiter. Thus, id specifiers such
as <tt>#contents</tt> and hex color specifications such
as <tt>#123</tt> would not be parsed correctly. Use the functions
instead, and pywebgen will translate appropriately. The above
definition generates the following CSS stylesheet:</p>

<pre>

body {
  padding: 1em;
  background-color: white;
}

#contents {
  border: 1px solid black;
  padding: 2em;
}

#contents h1 {
  margin-left: 2em;
  color: #3779af;
}
</pre>

<p>Notice how the nested style definition for <tt>h1</tt> is
"flattened" out in the CSS output.</p>

<p>Aside from these extra features, the language should be
self-explanatory: specify a CSS selector, then define the CSS style
properties that it should have. Here is a stylesheet for our trivial
website, which you could place in <tt>demo/source/style.css</tt></p>

<pre>
body:
  background-color: hex(eee)
  padding: 2em 25%

id(contents):
  border: 1px solid black
  background-color: white

h1:
  text-align: center
</pre>

<p>Try it out!</p>

<h2 id="other-file-types">What about other file types?</h2>

<p>So far we've covered HTML and CSS. But a website typically has
other files as well, such as images or javascript files. What about
those?</p>

<p>Since pywebgen doesn't know how to do anything fancy with these
file types, it will simply copy the files without touching them as it
generates. This means that any file that is not HTML or CSS that you
place in the <tt>source</tt> directory will also appear in the
generated site.</p>

<p>But what if you don't want a file to be copied? For example, the
base template for web pages isn't a standalone page, why would you
want to copy it? Well, pywebgen does make a few exceptions. One of the
most important ones is that it will not at all touch any file or
directory starting with an underscore.</p>

<p>If you are observant, you may have wondered why I named the base
template <tt>_base.html</tt>. Well, now you know: by naming it like
that, I instructed pywebgen to skip it during the generation
process. As a result, it is available to other templates such
as <tt>index.html</tt> during generation, but will not pollute the
generated website.</p>

<p>Pywebgen also skips typical "temporary" files. Specifically, it
will ignore emacs-style temporary files ending with <tt>~</tt>, or
starting with <tt>.#</tt>. It will <em>not</em> ignore dotfiles
(eg. <tt>.htaccess</tt>), because popular web servers such as apache
use these dotfiles to let users alter the server settings, a most
useful feature that shouldn't be jammed by pywebgen.</p>

<h2 id="managing-your-website">Managing your website</h2>

<p>We've come a fairly long way: we can now build a website composed
  of templatey HTML, tree-ish CSS, and any other files that suit our
  fancy. Now let's take a quick look at how to manage your
  website. We've already seen a couple of commands available to
  you. The most important, of course, is <tt>pwg generate</tt>,
  which you use to generate a new version of your website from
  source.</p>

<p>If you want to take a look at the versions you have available, you
can use <tt>pwg versions</tt> to list them:</p>

<pre>
$ ./pwg versions
Versions:
   0. 20081221-002155
   1. 20081221-001245
   2. 20081220-185531 (current)
   3. 20081220-184024
</pre>

<p>The <tt>versions</tt> command displays the timestamps of all the
  versions in reverse chronological order (most recent first). The
  timestamp, if you're having trouble seeing it, is in the
  format <tt>&lt;year&gt;&lt;month&gt;&lt;day&gt;-&lt;hour&gt;&lt;minute&gt;&lt;second&gt;</tt>. The
  version that is marked current, the one you can acces through
  the <tt>current</tt> symlink, is also pointed out.</p>

<p>If you want to change the version that is current, you can use
the <tt>setcurrent</tt> command:</p>

<pre>
$ ./pwg versions
Versions:
   0. 20081221-002155
   1. 20081221-001245
   2. 20081220-185531 (current)
   3. 20081220-184024
$ ./pwg setcurrent 1
Set current version to 20081221-001245.
$ ./pwg setcurrent 3
Set current version to 20081220-184024.
$ ./pwg setcurrent latest
Set current version to 20081221-002155.
</pre>

<p>As you can see, you can either use the version numbers given by
  the <tt>versions</tt> command to set the current version, or use the
  symbolic name <tt>latest</tt> to set it to the latest version.</p>

<p>Once you've set the current version and checked that the live site
  is doing all right, you'll probably have no more interest in the
  older versions of the site. You can get rid of them with
  the <tt>gc</tt> command:</p>

<pre>
$ ./pwg versions
Versions:
   0. 20081221-002155
   1. 20081221-001245 (current)
   2. 20081220-185531
   3. 20081220-184024
$ ./pwg gc
Garbage collected 2 versions:
  20081220-185531
  20081220-184024
$ ./pwg versions
Versions:
   0. 20081221-002155
   1. 20081221-001245 (current)
</pre>

<p>As you can see, the garbage collection only deletes versions that
  are older than the current version. It will never delete versions
  that are newer than the current live site.</p>

{% endblock %}
